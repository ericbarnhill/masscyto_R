knitr::opts_chunk$set(echo = TRUE)
#PROJ_DIR = "/home/ericbarnhill/Documents/code/R/masscyto_R"
PROJ_DIR ="./"
CYTOF_PATH <- file.path(PROJ_DIR, "cytof_data_2018_05_30.xlsx")
RTDC_PATH <- file.path(PROJ_DIR, "RT-DC_FCS_Statistics-AAS-1.xls")
knitr::opts_chunk$set(root.dir = PROJ_DIR)
setwd(PROJ_DIR)
packages <- c("gdata","tidyr","dplyr","magrittr", "ggplot2", "brms", "lattice", 'HDInterval')
lapply(packages, require, character.only = T)
theme_set(theme_default())
install.packages("gdata","tidyr","dplyr","magrittr", "ggplot2", "brms", "lattice", 'HDInterval')
install.packages("gdata")
install.packages("brms")
install.packages("lattice")
install.packages("lattice")
??theme_set
install.packages("ggplot2")
knitr::opts_chunk$set(echo = TRUE)
#PROJ_DIR = "/home/ericbarnhill/Documents/code/R/masscyto_R"
PROJ_DIR ="./"
CYTOF_PATH <- file.path(PROJ_DIR, "cytof_data_2018_05_30.xlsx")
RTDC_PATH <- file.path(PROJ_DIR, "RT-DC_FCS_Statistics-AAS-1.xls")
knitr::opts_chunk$set(root.dir = PROJ_DIR)
setwd(PROJ_DIR)
packages <- c("gdata","tidyr","dplyr","magrittr", "ggplot2", "brms", "lattice", 'HDInterval')
lapply(packages, require, character.only = T)
theme_set(theme_default())
library(ggplot2)
theme_set(theme_default())
??theme_default
knitr::opts_chunk$set(echo = TRUE)
#PROJ_DIR = "/home/ericbarnhill/Documents/code/R/masscyto_R"
PROJ_DIR ="./"
CYTOF_PATH <- file.path(PROJ_DIR, "cytof_data_2018_05_30.xlsx")
RTDC_PATH <- file.path(PROJ_DIR, "RT-DC_FCS_Statistics-AAS-1.xls")
knitr::opts_chunk$set(root.dir = PROJ_DIR)
setwd(PROJ_DIR)
packages <- c("gdata","tidyr","dplyr","magrittr", "ggplot2", "brms", "lattice", "HDInteval", "bayesplot")
lapply(packages, require, character.only = T)
theme_set(theme_default())
knitr::opts_chunk$set(echo = TRUE)
#PROJ_DIR = "/home/ericbarnhill/Documents/code/R/masscyto_R"
PROJ_DIR ="./"
CYTOF_PATH <- file.path(PROJ_DIR, "cytof_data_2018_05_30.xlsx")
RTDC_PATH <- file.path(PROJ_DIR, "RT-DC_FCS_Statistics-AAS-1.xls")
knitr::opts_chunk$set(root.dir = PROJ_DIR)
setwd(PROJ_DIR)
packages <- c("gdata","tidyr","dplyr","magrittr", "ggplot2", "brms", "lattice", "HDInteval", "bayesplot")
lapply(packages, require, character.only = T)
theme_set(theme_default())
source('masscyto_clean_gather_data_se.R')
setwd("/home/ericbarnhill/Documents/code/R/masscyto_R")
knitr::opts_chunk$set(echo = TRUE)
#PROJ_DIR = "/home/ericbarnhill/Documents/code/R/masscyto_R"
PROJ_DIR ="./"
CYTOF_PATH <- file.path(PROJ_DIR, "cytof_data_2018_05_30.xlsx")
RTDC_PATH <- file.path(PROJ_DIR, "RT-DC_FCS_Statistics-AAS-1.xls")
knitr::opts_chunk$set(root.dir = PROJ_DIR)
setwd(PROJ_DIR)
packages <- c("gdata","tidyr","dplyr","magrittr", "ggplot2", "brms", "lattice", "HDInteval", "bayesplot")
lapply(packages, require, character.only = T)
theme_set(theme_default())
source('masscyto_clean_gather_data_se.R')
install.packages('tidyverse')
install.packages("httr")
install.packages("openssl")
install.packages("openssl")
install.packages("httr")
install.packages("rvest")
install.packages("tidyverse")
knitr::opts_chunk$set(echo = TRUE)
#PROJ_DIR = "/home/ericbarnhill/Documents/code/R/masscyto_R"
PROJ_DIR ="./"
CYTOF_PATH <- file.path(PROJ_DIR, "cytof_data_2018_05_30.xlsx")
RTDC_PATH <- file.path(PROJ_DIR, "RT-DC_FCS_Statistics-AAS-1.xls")
knitr::opts_chunk$set(root.dir = PROJ_DIR)
setwd(PROJ_DIR)
packages <- c("gdata","tidyr","dplyr","magrittr", "ggplot2", "brms", "lattice", "HDInteval", "bayesplot")
lapply(packages, require, character.only = T)
theme_set(theme_default())
source('masscyto_clean_gather_data_se.R')
install.packages('rlist')
source('masscyto_clean_gather_data_se.R')
mass_cyto <- read.xls(xls=CYTOF_PATH,
header=FALSE, skip=3)
data_list <- clean_gather_data_se(mass_cyto)
source('masscyto_clean_gather_data_se.R')
#mass_cyto <- read.xls(xls=CYTOF_PATH,
#                      header=FALSE, skip=3)
data_list <- load_clean_data(CYTOF_PATH)
source('masscyto_clean_gather_data_se.R')
#mass_cyto <- read.xls(xls=CYTOF_PATH,
#                      header=FALSE, skip=3)
data_list <- load_clean_data(CYTOF_PATH)
source('masscyto_clean_gather_data_se.R')
#mass_cyto <- read.xls(xls=CYTOF_PATH,
#                      header=FALSE, skip=3)
data_list <- load_clean_data(CYTOF_PATH)
source('masscyto_clean_gather_data_se.R')
#mass_cyto <- read.xls(xls=CYTOF_PATH,
#                      header=FALSE, skip=3)
data_list <- load_clean_data(CYTOF_PATH)
source('masscyto_clean_gather_data_se.R')
#mass_cyto <- read.xls(xls=CYTOF_PATH,
#                      header=FALSE, skip=3)
data_list <- load_clean_data(CYTOF_PATH)
source('masscyto_clean_gather_data_se.R')
#mass_cyto <- read.xls(xls=CYTOF_PATH,
#                      header=FALSE, skip=3)
data_list <- load_clean_data(CYTOF_PATH)
knitr::opts_chunk$set(echo = TRUE)
#PROJ_DIR = "/home/ericbarnhill/Documents/code/R/masscyto_R"
PROJ_DIR ="./"
CYTOF_PATH <- file.path(PROJ_DIR, "cytof_data_2018_05_30.xlsx")
RTDC_PATH <- file.path(PROJ_DIR, "RT-DC_FCS_Statistics-AAS-1.xls")
knitr::opts_chunk$set(root.dir = PROJ_DIR)
setwd(PROJ_DIR)
packages <- c("gdata","tidyr","dplyr","magrittr", "ggplot2", "brms", "lattice", "HDInteval", "bayesplot")
lapply(packages, require, character.only = T)
theme_set(theme_default())
source('masscyto_clean_gather_data_se.R')
#mass_cyto <- read.xls(xls=CYTOF_PATH,
#                      header=FALSE, skip=3)
data_list <- load_clean_data(CYTOF_PATH)
source('masscyto_clean_gather_data_se.R')
#mass_cyto <- read.xls(xls=CYTOF_PATH,
#                      header=FALSE, skip=3)
data_list <- load_clean_data(CYTOF_PATH)
source('masscyto_clean_gather_data_se.R')
#mass_cyto <- read.xls(xls=CYTOF_PATH,
#                      header=FALSE, skip=3)
data_list <- load_clean_data(CYTOF_PATH)
source('masscyto_clean_gather_data_se.R')
#mass_cyto <- read.xls(xls=CYTOF_PATH,
#                      header=FALSE, skip=3)
data_list <- load_clean_data(CYTOF_PATH)
source('masscyto_clean_gather_data_se.R')
#mass_cyto <- read.xls(xls=CYTOF_PATH,
#                      header=FALSE, skip=3)
data_list <- load_clean_data(CYTOF_PATH)
source('masscyto_clean_gather_data_se.R')
#mass_cyto <- read.xls(xls=CYTOF_PATH,
#                      header=FALSE, skip=3)
data_list <- load_clean_data(CYTOF_PATH)
CYTOF_PATH <- file.path(PROJ_DIR, "cytof_data_2018_05_30.xlsx")
source('masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
head(mass_cyto)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
head(mass_cyto)
names(mass_cyto)
names(mass_cyto)
names(mass_cyto)
names(mass_cyto)
head(mass_cyto)
head(mass_cyto)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
events_cols
cnames
print(head(mass_cyto))
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
head(mass_cyto)
head(mass_cyto_tall)
names(mass_cyto)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
events_cols
adj_cols
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
mass_cyto["Counts"]
summary(mass_cyto["Counts"])
summary(as.numeric(mass_cyto["Counts"])
)
summary(as.numeric(unlist(mass_cyto["Counts"])))
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
events[m,n]
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
events[m,]
events[m,n]
data_list <- load_clean_data(CYTOF_PATH)
as.numeric(events[m,n]) / 100 * as.numeric(events[m,"Counts"])
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
as.numeric(events[m,n])
as.numeric(events[m,n]) / 100 * as.numeric(mass_cyto[m,"Counts"])
mass_cyto[m,"Counts"]
as.numeric(mass_cyto[m,"Counts"])
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
as.numeric(as.character(events[m,n])) / 100 * as.numeric(as.character(mass_cyto[m,"Counts"]))
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
events
mass_cyto[,events_cols]
as.numeric(mass_cyto[,events_cols])
as.numeric(as.data.frame(mass_cyto[,events_cols]))
as.numeric(as.character(mass_cyto[,events_cols]))
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
?matri
?matrix
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
?matrix
data_list <- load_clean_data(CYTOF_PATH)
nrow(events)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
head(events)
nrow(events)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
events_norms
events_norm
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
as.numeric(unlist(events[m,n])) / 100
as.numeric(unlist(mass_cyto[m,"Counts"]))
as.numeric(as.character(unlist(mass_cyto[m,"Counts"])))
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
events_norm
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
events_norm
head(mass_cyto)
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
head(mass_cyto)
head(mass_cyto_tall)
summary(mass_cyto)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
head(mass_cyto_tall)
head(mass_cyto)
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
head(mass_cyto)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
head(mass_cyto)
summary(mass_cyto)
?apply
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
head(mass_cyto)
summary(mass_cyto)
summary(mass_cyto)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
head(mass_cyto)
summary(mass_cyto)
data_list <- load_clean_data(CYTOF_PATH)
summary(mass_cyto)
summary(mass_cyto)
data_list <- load_clean_data(CYTOF_PATH)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
summary(mass_cyto)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
head(events)
head(mass_cyto["Counts"])
cnames
head(mass_cyto)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
head(mass_cyto)
head(mass_cyto)
head(mass_cyto)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
source('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
head(mass_cyto)
head(is.na(mass_cyto$Subject))
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
head(mass_cyto)
summary(mass_cyto)
head(mass_cyto_tall)
debugSource('~/Documents/code/R/masscyto_R/masscyto_clean_gather_data_se.R')
data_list <- load_clean_data(CYTOF_PATH)
head(data_list)
length(data_list)
head(data_list[[1]])
knitr::opts_chunk$set(echo = TRUE)
#PROJ_DIR = "/home/ericbarnhill/Documents/code/R/masscyto_R"
PROJ_DIR ="./"
CYTOF_PATH <- file.path(PROJ_DIR, "cytof_data_2018_05_30.xlsx")
RTDC_PATH <- file.path(PROJ_DIR, "RT-DC_FCS_Statistics-AAS-1.xls")
knitr::opts_chunk$set(root.dir = PROJ_DIR)
setwd(PROJ_DIR)
packages <- c("gdata","tidyr","dplyr","magrittr", "ggplot2", "brms", "lattice", "HDInteval", "bayesplot")
lapply(packages, require, character.only = T)
theme_set(theme_default())
source('masscyto_clean_gather_data_se.R')
#mass_cyto <- read.xls(xls=CYTOF_PATH,
#                      header=FALSE, skip=3)
data_list <- load_clean_data(CYTOF_PATH)
#masscyto_data_tall <- data_list[[1]]
#masscyto_data_wide <- data_list[[2]]
#print(summary(masscyto_data_wide))
means <- subset(masscyto_data_tall, (Stat_Type == "Mean") & Contrast_Agent != "control")
knitr::opts_chunk$set(echo = TRUE)
#PROJ_DIR = "/home/ericbarnhill/Documents/code/R/masscyto_R"
PROJ_DIR ="./"
CYTOF_PATH <- file.path(PROJ_DIR, "cytof_data_2018_05_30.xlsx")
RTDC_PATH <- file.path(PROJ_DIR, "RT-DC_FCS_Statistics-AAS-1.xls")
knitr::opts_chunk$set(root.dir = PROJ_DIR)
setwd(PROJ_DIR)
packages <- c("gdata","tidyr","dplyr","magrittr", "ggplot2", "brms", "lattice", "HDInteval", "bayesplot")
lapply(packages, require, character.only = T)
theme_set(theme_default())
source('masscyto_clean_gather_data_se.R')
#mass_cyto <- read.xls(xls=CYTOF_PATH,
#                      header=FALSE, skip=3)
data_list <- load_clean_data(CYTOF_PATH)
masscyto_data_tall <- data_list[[1]]
masscyto_data_wide <- data_list[[2]]
print(summary(masscyto_data_wide))
means <- subset(masscyto_data_tall, (Stat_Type == "Mean") & Contrast_Agent != "control")
means_conc_1 <- subset(means, (Concentration == 1))
means_conc_1$Contrast_Agent <- factor(means_conc_1$Contrast_Agent, c("Dotarem", "Magnevist", "Gadovist"))
plt <- ggplot(means_conc_1) +
geom_point(aes(x=Contrast_Agent, y=log(Value), color=Cell_Type)) +
facet_wrap(~ Cell_Type, ncol=3) +
ggtitle("Means By Contrast Agent @ Concentration 1") +
scale_x_discrete(labels = c("Dot", "Mag", "Gad"))
print(plt)
ggplot(subset(means, Contrast_Agent != 'control')) +
geom_line(aes(x=log(Concentration), y=log(Value), group=Cell_Type, color=Cell_Type)) +
facet_wrap(~ Experiment + Contrast_Agent, scales='free')
## hand-coded sliding contrasts:
masscyto_data_wide$GvsM<-ifelse(masscyto_data_wide$Contrast_Agent=="Gadovist",1,
ifelse(masscyto_data_wide$Contrast_Agent=="Magnevist",-1,0))
masscyto_data_wide$MvsD<-ifelse(masscyto_data_wide$Contrast_Agent=="Magnevist",1,
ifelse(masscyto_data_wide$Contrast_Agent=="Dotarem",-1,0))
priors<-c(set_prior("cauchy(0,10)", class = "b"),
set_prior("normal(0,1)", class = "sd"),
set_prior("lkj(2)", class = "cor"))
require(brms)
install.packages(brms)
install.packages('brms')
knitr::opts_chunk$set(echo = TRUE)
#PROJ_DIR = "/home/ericbarnhill/Documents/code/R/masscyto_R"
PROJ_DIR ="./"
CYTOF_PATH <- file.path(PROJ_DIR, "cytof_data_2018_05_30.xlsx")
RTDC_PATH <- file.path(PROJ_DIR, "RT-DC_FCS_Statistics-AAS-1.xls")
knitr::opts_chunk$set(root.dir = PROJ_DIR)
setwd(PROJ_DIR)
packages <- c("gdata","tidyr","dplyr","magrittr", "ggplot2", "brms", "lattice", "HDInteval", "bayesplot")
lapply(packages, require, character.only = T)
theme_set(theme_default())
source('masscyto_clean_gather_data_se.R')
#mass_cyto <- read.xls(xls=CYTOF_PATH,
#                      header=FALSE, skip=3)
data_list <- load_clean_data(CYTOF_PATH)
masscyto_data_tall <- data_list[[1]]
masscyto_data_wide <- data_list[[2]]
print(summary(masscyto_data_wide))
means <- subset(masscyto_data_tall, (Stat_Type == "Mean") & Contrast_Agent != "control")
means_conc_1 <- subset(means, (Concentration == 1))
means_conc_1$Contrast_Agent <- factor(means_conc_1$Contrast_Agent, c("Dotarem", "Magnevist", "Gadovist"))
plt <- ggplot(means_conc_1) +
geom_point(aes(x=Contrast_Agent, y=log(Value), color=Cell_Type)) +
facet_wrap(~ Cell_Type, ncol=3) +
ggtitle("Means By Contrast Agent @ Concentration 1") +
scale_x_discrete(labels = c("Dot", "Mag", "Gad"))
print(plt)
ggplot(subset(means, Contrast_Agent != 'control')) +
geom_line(aes(x=log(Concentration), y=log(Value), group=Cell_Type, color=Cell_Type)) +
facet_wrap(~ Experiment + Contrast_Agent, scales='free')
## hand-coded sliding contrasts:
masscyto_data_wide$GvsM<-ifelse(masscyto_data_wide$Contrast_Agent=="Gadovist",1,
ifelse(masscyto_data_wide$Contrast_Agent=="Magnevist",-1,0))
masscyto_data_wide$MvsD<-ifelse(masscyto_data_wide$Contrast_Agent=="Magnevist",1,
ifelse(masscyto_data_wide$Contrast_Agent=="Dotarem",-1,0))
priors<-c(set_prior("cauchy(0,10)", class = "b"),
set_prior("normal(0,1)", class = "sd"),
set_prior("lkj(2)", class = "cor"))
brm_df <- subset(masscyto_data_wide[c("logMean", "SE", "logConcentration", "GvsM", "MvsD", "Cell_Type", "Contrast_Agent")], Contrast_Agent!="control")
brm_df$Contrast_Agent <- factor(brm_df$Contrast_Agent, labels = c("Gadovist", "Magnevist", "Dotarem"))
cytof_brm_log<-brm(formula = logMean | se(SE) ~
logConcentration +
GvsM+
MvsD+
logConcentration:GvsM +
logConcentration:MvsD +
(1 +
logConcentration +
GvsM+
MvsD+
logConcentration:GvsM +
logConcentration:MvsD
| Cell_Type),
data = brm_df,
family = gaussian(),
prior = priors,
warmup = 1000,
iter = 2000,
chains = 4,
control = list(adapt_delta = 0.99,max_treedepth=15))
stanplot(cytof_brm_log, type="hist",pars=c("^b"))
mag_gad_log <- unlist(exp(posterior_samples(cytof_brm_log, 'b_GvsM', exact_match=T)))
dot_mag_log <- unlist(exp(posterior_samples(cytof_brm_log, 'b_MvsD', exact_match=T)))
print('95% HDI, log(Gad) > log(Mag) :')
print(hdi(mag_gad_log))
install.packages('HDInterval')
?hdi
library(HDInterval)
?hdi
hdi
